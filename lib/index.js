!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash/cloneDeep")):"function"==typeof define&&define.amd?define(["lodash/cloneDeep"],t):(e=e||self).ceval=t(e.cloneDeep)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;class t{constructor(e,t){this.type=e,this.value=null!=t?t:0}}const s="TOKEN_END",n="TOKEN_COMMA",r="TOKEN_SEMICOLON";class i{constructor(e,t,s){this.type=e,this.value=t,this.index=s,this.toString=()=>this.type+": "+this.value,window._debug&&console.log(`type: ${e}; value: ${t}; index: ${s}`)}}const{toString:o}=Object.prototype;function a(e){return"[object Object]"===o.call(e)}function h(e,t){return e.some(e=>e===t)}function c(e,t){return Object.keys(t).forEach(s=>{const n=t[s];Object.prototype.hasOwnProperty.call(e,s)||(Array.isArray(n)?c(e[s]=[],n):a(n)?c(e[s]={},n):e[s]=n)}),e}function p(...e){let t;return e.some(e=>!h([void 0,null,!0,!1],e)&&(t=e,!0)),t}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function l(e,s){if("string"==typeof e[0]&&e.length!==[...new Set(e)].length)throw new Error("Duplicate parameter: "+e.join(","));const n=Object.create(null);return e.forEach(e=>{let r;r=e instanceof t?e.value:e,n[r]="function"==typeof s?s(r):s}),n}function E(...e){const t=e.pop();if(!e.find(e=>!!e))throw new Error(t)}function d(e){return(e.toString().split(".")[1]||"").length}function f(e){return e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER}function O(e,t){const s=Math.pow(10,Math.max(d(e),d(t)));return f(e*s)||f(t*s)?0:s}const N=(e,t)=>Number.isInteger(e)&&Number.isInteger(t)||"number"!=typeof e||"number"!=typeof t;const T={functions:{random:function(e){return Math.random()*(e||1)},min:function(...e){return e.length,Math.min.apply(Math,e)},max:function(...e){return e.length,Math.max.apply(Math,e)},map:function(e,t){if("function"!=typeof e)throw new Error("First argument is not a function");if(!Array.isArray(t))throw new Error("Second argument is not an array");return t.map((function(t,s){return e(t,s)}))}},consts:{E:Math.E,PI:Math.PI,true:!0,false:!1,undefined:void 0,null:null},binaryOps:{"+":function(e,t,s){if(!1===s.allowHandleNumberPrecision||N(e,t))return e+t;const n=O(e,t);return 0===n?e+t:(Math.round(e*n)+Math.round(t*n))/n},"-":function(e,t,s){if(!1===s.allowHandleNumberPrecision||N(e,t))return e-t;const n=O(e,t);return 0===n?e-t:(Math.round(e*n)-Math.round(t*n))/n},"*":function(e,t,s){if(!1===s.allowHandleNumberPrecision||N(e,t))return e*t;const n=O(e,t);return 0===n?e*t:Math.round(e*n)*Math.round(t*n)/Math.pow(n,2)},"/":function(e,t,s){if(!1===s.allowHandleNumberPrecision||N(e,t))return e/t;const n=O(e,t);return 0===n?e/t:Math.round(e*n)/Math.round(t*n)},"%":function(e,t){return e%t},"^":function(e,t){return e^t},"||":function(e,t){return e||t},"&&":function(e,t){return e?t:e},"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},"<":function(e,t){return e<t},">=":function(e,t){return e>=t},"<=":function(e,t){return e<=t},"=":function(e,t,s){return s&&(s[e]=t),t},"[":function(e,t){return e[0|t]},"===":function(e,t){return e===t},in:function(e,t){if("object"!=typeof t||String(e)!==""+e)throw new Error("first argument must be original type, second must be Array or Object");return a(t)?Object.prototype.hasOwnProperty.call(t,function e(t){const s=/^\"(.*)\"$|^\'(.*)\'$/;if(!s.test(t))return t;const n=s.exec(t);return e(void 0!==n[1]?n[1]:n[2])}(e)):h(t,e)}},ternaryOps:{"?":function(e,t,s){return e?t:s}},unaryOps:{"+":e=>+e,"-":e=>-e,"!":e=>!e,"~":e=>~e,"++":e=>e+1,"--":e=>e-1,typeof:e=>typeof e,return:e=>e,sin:Math.sin,cos:Math.cos,tan:Math.tan,pow:Math.pow},syntaxOperator:{":":null,".":null}},x=["=","["],w=function e(t,s,n){return Object.keys(s).map(r=>a(s[r])?e(t,s[r],n):n(t,r,s[r])),t}(Object.create(null),{functions:T.functions,consts:T.consts,unaryOps:T.unaryOps,ternaryOps:T.ternaryOps},(e,t,s)=>{x.includes(t)||(e[t]=s)}),b=[],_=Array.from(new Set([].concat(Object.keys(T.unaryOps).filter(e=>!/\b\w+\b/.test(e)),Object.keys(T.binaryOps),Object.keys(T.ternaryOps),Object.keys(T.syntaxOperator)).filter(e=>!h(b,e)).sort((e,t)=>t.length-e.length))),g=/(\t|\n|\r|\s+)/,v=/^(false|true)/,m=/^\/\*(.*)\*\//,y=/^\'(.*?)\'|^\"(.*?)\"/,R=/^\'(.*)\'|^\"(.*)\"/,S=/^(0b[0|1]{1,})$/,A=/^(0[0-7]{1,})$/,P=/^(0\d*[8-9]{1,}\d*(\.\d+)?)$/,k=/(^([1-9]\d*(\.\d+)|(\d*(\.\d+)?)))/,C=/^(0x[0-9a-fA-F]{1,})$/,I=/^((_|$)?[0-9a-zA-Z|$|_]{1,})/,M=new RegExp(`^(${_.map(e=>`(\\${/\b\w+\b/.test(e)?e:e.split("").join("\\")})`).join("|")})`),K=new RegExp(`^(${Object.keys(T.unaryOps).filter(e=>/\b\w+\b/.test(e)).join("|")})`),j=new RegExp(`^(${Object.keys(T.unaryOps).filter(e=>!/\b\w+\b/.test(e)).map(e=>`\\s*\\${e}\\s*`).join("|")})`),F=(e,t,s=(e=>e))=>{e.lastIndex=0;const n=e.exec(t);return null===n||""===n[0]?s(void 0):s(n[1])},U=({value:e})=>Object.prototype.hasOwnProperty.call(T.unaryOps,e);let $=(()=>{class e{constructor(e,i,o){this.ceval=e,this.tokens=i,this.current=null,this.savedCurrent=null,this.nextToken=null,this.savedNextToken=null,this.inspectParseEnd=e=>{do{this.parseExpression(e)}while(this.tokens.pos<this.tokens.expression.length)},this.next=()=>(this.current=this.nextToken,this.nextToken=this.tokens.next()),this.matchToken=e=>void 0===e||(Array.isArray(e)?-1!==e.indexOf(this.nextToken.value):"function"==typeof e?e(this.nextToken):("string"==typeof e||"number"==typeof e)&&e===this.nextToken.value),this.accept=(e,t,s=!0)=>!(!this.nextToken||this.nextToken.type!==e||!this.matchToken(t))&&(s&&this.next(),!0),this.expect=(e,t)=>{if(!this.accept(e,t)){const{line:e,column:n}=this.tokens.getCoordinates();throw this.printLog(`> line:${e} column:${n-1} "${this.current.value}"\nThe next tag should be "${t}", But the reality is`,""+(this.nextToken.type===s?"empty content":`"${this.nextToken.value}"`),console.error),new Error("Unexpected Tag")}},this.temporarySaved=()=>{this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.temporarySaved()},this.restore=()=>{this.current=this.savedCurrent,this.nextToken=this.savedNextToken,this.tokens.restore()},this.parseExpression=e=>{const t=[];this.parseMultipleEvaluation(t),t.forEach(t=>e.push(t))},this.parseMultipleEvaluation=e=>{for(this.parseAssignmentExpression(e);this.accept(n,",");)this.parseConditionalExpression(e)},this.parseAssignmentExpression=e=>{for(this.parseConditionalExpression(e);this.accept("TOKEN_OP","=");){let s;"INSTR_VAR"===e[e.length-1].type&&(s=e.pop()),"INSTR_NAME"===e[e.length-1].type&&e.push(new t("INSTR_VARNAME",e.pop().value));const n=[];this.parseExpression(n),e.push(new t("INSTR_EXPRE",n)),s&&e.push(s),e.push(new t("INSTR_OP2","="))}},this.parseConditionalExpression=e=>{for(this.parseOrExpression(e);this.accept("TOKEN_OP","?");){const s=[],n=[];this.parseConditionalExpression(s),this.expect("TOKEN_OP",":"),this.parseConditionalExpression(n),e.push(new t("INSTR_EXPRE",s)),e.push(new t("INSTR_EXPRE",n)),e.push(new t("INSTR_OP3","?"))}},this.parseOrExpression=e=>{for(this.parseAndExpression(e);this.accept("TOKEN_OP","||");){var s=[];this.parseAndExpression(s),e.push(new t("INSTR_EXPRE",s)),e.push(new t("INSTR_OP2","||"))}},this.parseAndExpression=e=>{for(this.parseBitwiseOrExpression(e);this.accept("TOKEN_OP","&&");){var s=[];this.parseBitwiseOrExpression(s),e.push(new t("INSTR_EXPRE",s)),e.push(new t("INSTR_OP2","&&"))}},this.parseBitwiseOrExpression=e=>{for(this.parseBitwiseAndExpression(e);this.accept("TOKEN_OP","^");)this.parseBitwiseAndExpression(e),e.push(new t("INSTR_OP2","^"))},this.parseBitwiseAndExpression=e=>{for(this.parseEqualExpression(e);this.accept("TOKEN_OP","&");)this.parseBitwiseAndExpression(e),e.push(new t("INSTR_OP2","&"))},this.parseEqualExpression=e=>{for(this.parseCompareExpression(e);this.accept("TOKEN_OP",["==","===","!=","!=="]);){var s=this.current;this.parseCompareExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseCompareExpression=e=>{for(this.parseInOrAtExpression(e);this.accept("TOKEN_OP",["<","<=",">=",">"]);){var s=this.current;this.parseInOrAtExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseInOrAtExpression=e=>{for(this.parseBitwiseMoveExpression(e);this.accept("TOKEN_OP",["in"]);){var s=this.current;this.parseBitwiseMoveExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseBitwiseMoveExpression=e=>{for(this.parseAddOrSubExpression(e);this.accept("TOKEN_OP",[">>",">>>","<<"]);){var s=this.current;this.parseAddOrSubExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseAddOrSubExpression=e=>{for(this.parseMulOrDivExpression(e);this.accept("TOKEN_OP",["+","-"]);){var s=this.current;this.parseMulOrDivExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseMulOrDivExpression=e=>{for(this.parseUnaryExpression(e);this.accept("TOKEN_OP",["*","/","%"]);){var s=this.current;this.parseUnaryExpression(e),e.push(new t("INSTR_OP2",s.value))}},this.parseUnaryExpression=e=>{if(this.temporarySaved(),this.accept("TOKEN_OP",U))if(j.test(this.current.value)){const s=this.current;this.parseUnaryExpression(e),e.push(new t("INSTR_OP1",s.value))}else this.accept("TOKEN_PAREN","(",!1)?(this.restore(),this.parsePersetFuncCallExpression(e)):(-1!==[n,r,s].indexOf(this.nextToken.type)||"TOKEN_PAREN"===this.nextToken.type&&")"===this.nextToken.value)&&(this.restore(),this.parseField(e));else this.parseOuterFunctionCallExpression(e)},this.parseOuterFunctionCallExpression=e=>{this.parseMemberAccessExpression(e),"TOKEN_NAME"===this.current.type&&this.accept("TOKEN_PAREN","(",!1)&&this.parseArguments(e)},this.parsePersetFuncCallExpression=e=>{if(this.accept("TOKEN_OP",U)){var s=this.current;this.parseField(e),e.push(new t("INSTR_OP1",s.value))}else this.parseMemberAccessExpression(e),this.parseArguments(e)},this.parseArguments=e=>{for(;this.accept("TOKEN_PAREN","(");)if(this.accept("TOKEN_PAREN",")"))e.push(new t("INSTR_FUNCALL",0));else{let s=0;for(;!this.accept("TOKEN_PAREN",")");)do{this.parseConditionalExpression(e),s++}while(this.accept(n));e.push(new t("INSTR_FUNCALL",s))}},this.parseMemberAccessExpression=e=>{for(this.parseField(e);this.accept("TOKEN_OP",".")||h(["TOKEN_SQUARE","TOKEN_NAME"],this.current.type)&&this.accept("TOKEN_SQUARE","[");){if(!this.ceval.getOptions().allowMemberAccess)throw new Error('options "allowMemberAccess": You have disabled member access and cannot use syntax such as "a.b" "a[\'b\']"');"."===this.current.value?(this.expect("TOKEN_NAME"),e.push(new t("INSTR_MEMBER",this.current.value))):"["===this.current.value&&(this.parseExpression(e),this.expect("TOKEN_SQUARE","]"),e.push(new t("INSTR_MEMBER")))}},this.parseField=e=>{if(this.accept("TOKEN_OP",U))e.push(new t("INSTR_OP1",this.current.value));else if(this.accept("TOKEN_NAME"))e.push(new t("INSTR_NAME",this.current.value));else if(this.accept("TOKEN_NUMBER"))e.push(new t("INSTR_NUMBER",this.current.value));else if(this.accept("TOKEN_STRING"))e.push(new t("INSTR_PLAIN",this.current.value));else if(this.accept("TOKEN_PAREN","("))this.parseExpression(e),this.expect("TOKEN_PAREN",")");else if(this.accept("TOKEN_SQUARE","["))this.parseArrayLiteralDeclaration(e);else if(this.accept("TOKEN_CURLY","{",!1))this.parseObjectLiteralDeclaration(e);else if(this.accept("TOKEN_CURLY","}",!1));else if(this.accept("TOKEN_VAR",["const","var","let"])){const s=this.current;this.parseField(e),e.push(new t("INSTR_VAR",s.value))}else if(this.accept("TOKEN_FUNC",void 0,!1))this.parseFunctionDefinedDeclaration(e);else if(!this.accept(r))throw new Error("unexpected "+this.nextToken)},this.parseArrayLiteralDeclaration=e=>{const s=[];this.accept("TOKEN_SQUARE","]")||(this.parseExpression(s),this.expect("TOKEN_SQUARE","]")),e.push(new t("INSTR_ARRAY",s))},this.parseObjectLiteralDeclaration=e=>{for(;this.accept("TOKEN_CURLY","{");){const s={};if(this.accept("TOKEN_CURLY","}"))return void e.push(new t("INSTR_OBJECT",s));for(;this.accept("TOKEN_NAME")||this.accept("TOKEN_NUMBER")||this.accept("TOKEN_STRING");){const e=this.current.value;this.expect("TOKEN_OP",":"),s[e]=[],this.accept("TOKEN_CURLY","{",!1)?this.parseObjectLiteralDeclaration(s[e]):this.parseConditionalExpression(s[e]),this.accept(n,",")}this.expect("TOKEN_CURLY","}"),this.accept(r,";"),e.push(new t("INSTR_OBJECT",s))}},this.parseFunctionDefinedDeclaration=e=>{for(;this.accept("TOKEN_FUNC");)if(this.accept("TOKEN_NAME")){const s=this.current.value,r=[];if(this.accept("TOKEN_PAREN","(")){do{this.parseField(r)}while(this.accept(n));this.expect("TOKEN_PAREN",")")}this.parseFunctionBodyExpression(r),e.push(new t("INSTR_FUNCDEF",r)),e.push(new t("INSTR_FUNCDEF",s))}},this.parseFunctionBodyExpression=e=>{if(this.accept("TOKEN_CURLY","{")){const s=[];do{this.parseExpression(s)}while(this.accept(r,";"));this.expect("TOKEN_CURLY","}"),this.accept(r,";"),e.push(new t("INSTR_EXPRE",s))}},this.printLog=(e,t,s=console.log)=>{s(`${e} %c${t}`,"margin: 0 .5em;text-decoration-line: underline;text-decoration-color: red;text-decoration-style: wavy;line-height: 2em;color: red;")},this.next(),this.inspectParseEnd(o)}}return e.generatorParser=(t,s,n)=>new e(t,s,n),e})();const B={abstract:!1,arguments:!1,boolean:!1,break:!1,byte:!1,case:!1,catch:!1,char:!1,class:!1,const:!1,continue:!1,debugger:!1,default:!1,delete:!1,do:!1,double:!1,else:!1,enum:!1,eval:!1,export:!1,extends:!1,final:!1,finally:!1,float:!1,for:!1,function:!1,goto:!1,if:!1,implements:!1,import:!1,in:!0,instanceof:!1,int:!1,interface:!1,let:!1,long:!1,native:!1,new:!1,null:!1,package:!1,private:!1,protected:!1,public:!1,return:!0,short:!1,static:!1,super:!1,switch:!1,synchronized:!1,this:!1,throw:!1,throws:!1,transient:!1,try:!1,typeof:!1,var:!1,void:!1,volatile:!1,while:!1,with:!1,yield:!1},D={Array:!1,Date:!1,eval:!1,function:!1,hasOwnProperty:!1,Infinity:!1,isFinite:!1,isNaN:!1,isPrototypeOf:!1,length:!1,Math:!1,NaN:!1,name:!1,Number:!1,Object:!1,prototype:!1,String:!1,toString:!1,undefined:!1,valueOf:!1};class L{constructor(e,t){this.ceval=e,this.expression=t,this.pos=0,this.current=null,this.savedPosition=0,this.savedCurrent=null,this.checkNextAccessGrammar=()=>{const{pos:e}=this,{current:t}=this,s=this.next();return this.current=t,this.pos=e,s},this.getSomeCode=(e=1,t=0)=>{const s=t+this.pos,{length:n}=this.expression;return this.expression.substr(s,s+e>n?n-s:e)},this.getFirstWord=()=>{const e=this.expression.substr(this.pos).match(/\b\w*\b/);return e?e[0]:""},this.newToken=(e,t,s)=>new i(e,t,null!=s?s:this.pos),this.next=()=>this.expression.length?this.pos>=this.expression.length?this.newToken(s,"END"):this.isWhiteSpace()||this.isComment()?this.next():this.isNumber()||this.isString()||this.isBoolean()||this.isParenthesis()||this.isComma()||this.isOperator()||this.isSemicolon()||this.isConst()||this.isVariable()||this.isFunctionDefined()||this.isName()?this.current:void this.parseError("unknown character: "+this.expression.charAt(this.pos),SyntaxError):this.newToken("TOKEN_NAME","undefined"),this.temporarySaved=()=>{this.savedPosition=this.pos,this.savedCurrent=this.current},this.restore=()=>{this.pos=this.savedPosition,this.current=this.savedCurrent},this.isWhiteSpace=()=>{const e=g.exec(this.getSomeCode());for(;e&&e[1];)return this.pos++,!0;return!1},this.isComment=()=>{if("/"===this.getSomeCode()&&"*"===this.getSomeCode(1,1)){m.lastIndex=0;const e=m.exec(this.getSomeCode(1/0));if(e&&e[1])return this.pos+=e[1].length+2+2,!0}return!1},this.isBoolean=()=>{const e=v.exec(this.getSomeCode());for(;e&&e[1];)return this.pos++,!0;return!1},this.isVariable=()=>{const e=this.getFirstWord();if(h(["const","var","let"],e)){this.pos+=e.length,this.current=this.newToken("TOKEN_VAR",e);const t=this.checkNextAccessGrammar();if("TOKEN_NAME"!==t.type)throw new Error(`"${e}" ${t.value} : This syntax Not as expected, should be "TOKEN_NAME", but is "${t}"`);return!0}return!1},this.isNumber=()=>{const e=this.getSomeCode();let t,s;const n=this.getSomeCode(this.expression.length-this.pos);if(!1===/\d|\./.test(e)||"."===e&&!1===/\.\d/.test(this.getSomeCode(2)))return!1;const[r]=n.match(/^(0(x|b)+[0-9a-zA-Z]{1,})|(^0?\d*(\.\d+)?)/);if(k.lastIndex=0,"0"===e&&r.length>1&&!/^0\.\d/.test(r)){if(h(["b","x"],this.getSomeCode(1,1))&&"."===this.getSomeCode(1,r.length))return this.parseError(`number '${r}' cannot is a floating point number, but actual is: '${r}${this.getSomeCode(3,r.length)}'`,SyntaxError),!1;if(S.test(r))t=F(S,r),s=void 0===t?void 0:2;else if(A.test(r))t=F(A,r),s=void 0===t?void 0:8;else if(C.test(r))t=F(C,r),s=void 0===t?void 0:16;else{if(!P.test(r))return this.parseError("number bitbase parser error",SyntaxError),!1;t=F(P,r),s=void 0===t?void 0:10}if(void 0!==t&&!this.ceval.getOptions().endableBitNumber)throw new Error('options "endableBitNumber": You have disabled bitbase number parsing, Not allowed '+t)}else{if(!k.test(n))return!1;t=F(k,n),s=void 0===t?void 0:10}return this.current=10===s?this.newToken("TOKEN_NUMBER",parseFloat(t)):this.newToken("TOKEN_NUMBER",parseInt(t.replace("0b","").replace("0x",""),s)),this.pos+=t.length,!0},this.isString=()=>{const e=this.getSomeCode(),t=this.getSomeCode(1/0);let s,n;return('"'===e||"'"===e)&&(s=R.exec(t),n=p(s[1],s[2]),function(e){let t=0;for(;h(["'",'"'],e.charAt(t))&&e.charAt(t)===e.charAt(e.length-1-t);)t++;const s=e.substring(t,e.length-t);return-1===s.indexOf('"')&&-1===s.indexOf("'")}(n)||(s=y.exec(t),n=p(s[1],s[2])),void 0!==n)&&(this.current=this.newToken("TOKEN_STRING",n,this.pos),this.pos+=n.length+2*e.length,!0)},this.isFunctionDefined=()=>{const e=this.getFirstWord();if("function"===e){this.current=this.newToken("TOKEN_FUNC",void 0),this.pos+=e.length;return"TOKEN_NAME"===this.checkNextAccessGrammar().type||(this.parseError("function definition should have function name"),!1)}return!1},this.isName=()=>{const e=this.getSomeCode();let t;return("_"===e||"$"===e||/^[a-zA-Z]/.test(e))&&(I.lastIndex=0,t=I.exec(this.getSomeCode(1/0))),null!=t&&"string"==typeof t[1]&&(!1===B[t[1]]?(this.parseError("parser an reserved word: "+t[1]),!1):!1===D[t[1]]?(this.parseError("parser an window native attributes or methods: "+t[1]),!1):(this.pos+=t[1].length,this.current=this.newToken("TOKEN_NAME",t[1]),!0))},this.isConst=()=>{const e=Object.keys(this.ceval.consts),t=new RegExp(`^(${e.join("|")})`).exec(this.getSomeCode(1/0));return!(!t||!t[1])&&(this.current=this.newToken("TOKEN_NAME",t[1]),this.pos+=t[1].length,!0)},this.isSemicolon=()=>";"===this.getSomeCode()&&(this.current=this.newToken(r,";"),this.pos++,!0),this.isComma=()=>","===this.getSomeCode()&&(this.current=this.newToken(n,","),this.pos++,!0),this.isParenthesis=()=>{var e=this.getSomeCode();if(h(["(",")"],e))this.current=this.newToken("TOKEN_PAREN",e);else if(h(["[","]"],e))this.current=this.newToken("TOKEN_SQUARE",e);else{if(!h(["{","}"],e))return!1;this.current=this.newToken("TOKEN_CURLY",e)}return this.pos++,!0},this.isOperator=()=>{const e=this.getSomeCode(1/0);let t;if(M.test(e)?(M.lastIndex=0,t=M.exec(e)):K.test(e)&&(K.lastIndex=0,t=K.exec(e)),!t)return!1;if(!1===this.ceval.getOptions().endableOperators)throw new Error(`options "endableOperators": You disabled the operator, Therefore, "${t[1]}" it can not be used`);return this.pos+=t[1].length,this.current=this.newToken("TOKEN_OP",t[1]),!0},this.getCoordinates=()=>{let e=0,t=0,s=-1;do{e++,t=this.pos-s,s=this.expression.substr(s+1).indexOf("\n")}while(s>=0&&s<this.pos);return{line:e,column:t}},this.parseError=(e,t=Error)=>{var s=this.getCoordinates();throw new t("parse error ["+s.line+":"+s.column+"] => "+e)}}}function V(e,s=Object.create(null),n,r=!1,i=Object.create(null)){window.name&&(console.group("calclation Dev"),console.log("tokens: ",e),console.log("values",s),console.log("scope",i),console.groupEnd());const o=n.getOptions(),{unaryOps:a,binaryOps:h,ternaryOps:p}=n,l=[],{length:d}=e;let f,O,N,T;for(let x=0;x<d;x++){const d=e[x],{type:w,value:b}=d||{};if(w)switch(w){case"INSTR_NUMBER":case"INSTR_PLAIN":case"INSTR_VARNAME":l.push(b);break;case"INSTR_NAME":if(u(i,b))l.push(i[b]);else if(u(s,b))l.push(s[b]);else{if(!u(n.consts,b))throw new Error(b+" is not defined in values or consts");l.push(n.consts[b])}break;case"INSTR_OP1":if(0===l.length)break;[f]=l.splice(-1,1),T=Y(b,[s,a],o.allowOperatorsCovered),l.push(T(f));break;case"INSTR_OP2":if(l.length<2)break;[f,O]=l.splice(-2,2),T=Y(b,[s,h],o.allowOperatorsCovered),"&&"===b?l.push(T(f,V([O],s,n,r,i),!1)):"="===b?(E(u(i,f),u(s,f),f+" is not define in values or current scope, if you are declaring a new variable, please add var, const or let Operator"),T(f,O,u(i,f)?i:s)):l.push(T(f,V([O],s,n,r,i),o));break;case"INSTR_OP3":if(l.length<3)break;[f,O,N]=l.splice(-3,3),T=Y(b,[s,p],o.allowOperatorsCovered),l.push(T(f,O,N));break;case"INSTR_EXPRE":l.push(V(d.value,s,n,r,i));break;case"INSTR_MEMBER":if(l.length<1)break;if(!b){[f,O]=l.splice(-2,2),l.push(f[O]);break}f=l.pop(),l.push(f[b]);break;case"INSTR_ARRAY":l.push(V(b,s,n,!0,i));break;case"INSTR_OBJECT":{const e=Object.create(null);Object.keys(b).forEach(t=>{e[t]=V(b[t],s,n,r,i)}),l.push(e);break}case"INSTR_VAR":switch([f,O]=l.splice(-2,2),b){case"let":case"const":u(i,f)&&console.warn(f+" already statement in consts or scope"),i[f]=O;break;case"var":s[f]=O;break;default:console.warn("Unexpected statement identifier")}break;case"INSTR_FUNCALL":{const e=l.splice(-b,b);if(T=l.pop(),"function"==typeof T){l.push(T.apply(null,e));continue}T.value instanceof X&&(T.value.updateScope(e),l.push(T.value.invokeBody()));break}case"INSTR_FUNCDEF":{if("string"!=typeof b){l.push(b);continue}if(0===l.length)return;const e=c(Object.create(null),i);e[b]=new t("INSTR_EXECUTBODY",new X(l.pop(),s,e,n)),Object.assign(i,e);break}default:{const e=Symbol("_init");let t=e;try{t=d.value}catch(e){}t!==e&&l.push(t)}}else l.push(d)}return r?l:l[0]}function Y(e,[t,s],n=!1){let r;return r=n&&u(t,e)?t[e]:s[e],r}class X{constructor(e,t,s,n){this.func=e,this.values=t,this._scope=s,this.ceval=n,this.updateScope=e=>{this.args.forEach((t,s)=>{u(this._scope,t)&&(this._scope[t]=e[s])})},this.invokeBody=()=>V(this.func,this.values,this.ceval,!1,this._scope);const r=this.func.splice(0,e.length-1);this.args=V(r,l(r,e=>e),n,!0),this._scope=c(l(r),s)}}const[G,Q]=function(e=0){const t=new Date(Date.now()+e);return[`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`.replace(/\d+/g,e=>parseInt(e,10)<10?"0"+e:e)]}();var H={now:Date.now(),date:G,time:Q};class W{constructor(){this.endableOperators=!0,this.endableBitNumber=!0,this.allowMemberAccess=!0,this.allowHandleNumberPrecision=!0,this.allowOperatorsCovered=!1,this.defaultReturnValues=""}}return class{constructor(t={}){this.options=t,this.operatorMap=w,this.currentValues=e(H),this.getSupportOperationMap=e=>Object.prototype.hasOwnProperty.call(w,e)?w[e]:null,this.parseString=(e,t={})=>{const s=[];return $.generatorParser(this,new L(this,e),s),this.injectValueToCalc(s,t)},this.getCurrentValues=()=>e(this.currentValues),this.injectValueToCalc=(e,t={})=>{this.updatePresetValues(t);const s=V(e,this.currentValues,this);return void 0===s?this.options.defaultReturnValues:s},this.updatePresetValues=e=>{Object.assign(this.currentValues,e)},this.updateOptions=e=>{Object.assign(this.options,e)},this.getOptions=()=>e(this.options),Object.assign(this,T),c(this.options,new W)}}}));
//# sourceMappingURL=index.js.map
